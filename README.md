# MiaoTools

**🛠️ 概述**  
MiaoTools 是一个 Blender 插件，集合了多种便捷操作工具，以提升 Blender 的使用效率和工作流程。

## 基础工具集

- **模型编辑工具**

  **✂️ 概述**  
  提供基础的模型数据编辑功能，帮助快速处理模型数据和结构。

  **🔧 功能列表**
  | 功能 | 描述 | 适用场景 |
  |------|------|----------|
  | **移除顶点组** | 批量清除所选物体的顶点组数据 | 模型清理、优化导出模型 |
  | **移除修改器** | 批量移除所选物体上的修改器 | 模型简化、问题排查 |
  | **批量独立化物体** | 断开所选物体与其他物体的链接关系 | 准备导出、避免依赖问题 |
  | **矫正旋转** | 基于选择面重新定向物体的旋转轴 | 校正应用变换后的模型方向 |

  **💡 使用提示**
  - 矫正旋转时，先进入编辑模式选择一个正面作为参考
  - 独立化操作会断开数据链接，但保持变换信息

- **场景清理工具**

  **🧹 概述**  
  一系列专用于清理场景数据的工具，优化文件结构，解决常见数据问题。

  **🧰 核心功能**
  | 功能 | 作用 | 解决问题 |
  |------|------|----------|
  | **清空空集合** | 移除场景中没有内容的集合 | 整理场景层级 |
  | **清除无子集空物体** | 移除没有子对象的空物体 | 清理冗余结构 |
  | **批量清空动画** | 移除选中物体上的动画数据 | 静态导出准备 |
  | **清理无实体工具** | 清除没有顶点的mesh数据块 | 修复文件错误 |
  | **清理UV非法数据** | 移除损坏的UV映射数据 | 解决UV保存问题 |
  | **清理丢失图像** | 清除丢失源文件的图像数据块 | 修复纹理引用错误 |

  **⚠️ 注意事项**  
  无子集空物体清理需多次操作以递归处理深层级结构

- **对齐与原点工具**

  **📐 概述**  
  提供精确控制物体原点位置的工具，便于模型对齐和布局。

  **📍 功能说明**
  - **轴向投射**：将物体原点投射到选定轴方向
  - **边界投射**：将原点移动到物体在选定方向的最大值位置
  - **Z轴归零**：保持XY位置不变，将原点Z坐标设为0

  **🎯 适用场景**  
  模型摆放、物理模拟准备、动画设置

- **高级选择工具**

  **🔍 概述**  
  提供多种基于特定条件的选择工具，超越默认的选择功能。

  **👆 选择方式**
  | 工具 | 选择条件 | 控制参数 |
  |------|---------|----------|
  | **选取同UV物体** | UV重叠度 | UV贴图层、匹配阈值 |
  | **选取过大物体** | 尺寸上限 | 可调最小尺寸值 |
  | **选取过小物体** | 尺寸下限 | 可调最大尺寸值 |
  | **选取无贴图物体** | 材质状态 | 纹理类型筛选 |

  ![image](https://github.com/user-attachments/assets/f053ad8e-ad96-4658-ba99-a004fbab09dd)

- **快速生成工具**

  **⚡ 概述**  
  一组用于快速生成辅助几何体和实现特殊转换的工具。

  **🔄 功能列表**
  | 功能 | 描述 | 用途 |
  |------|------|------|
  | **生成包围盒** | 创建物体的立方体边界框，添加"_box"后缀 | 碰撞体设置、空间参考 |
  | **生成凸包** | 创建包含物体的凸多边形，添加"_col"后缀 | 简化碰撞体、物理模拟 |
  | **安全合并** | 合并物体但保持集合结构不变 | 保留组织的模型合并 |
  | **转换实例化** | 将多个物体替换为基准物体的实例 | 优化场景、统一编辑 |

  **🚀 工作流程**  
  选择目标物体 → 执行生成功能 → 自动创建并命名结果

## 导入导出工具

- **高级导出功能**

  **📤 概述**  
  提供针对多种游戏引擎优化的模型导出功能，支持批量和特定结构导出。

  **📋 主要功能**
  - **按顶级父级导出**：将场景中物体按顶级父物体组织导出为多个FBX
  - **Unity适配导出**：自动调整旋转和缩放以适应Unity坐标系统
  - **按标记导出**：根据特定命名标记("_col"等)导出物体
  - **保持集合结构导出**：保留原始集合组织结构的导出方式

  **⚙️ 配置选项**
  - 导出目录路径设置
  - 转换选项(适用于不同引擎)
  - 导出模式选择

  **💼 适用场景**  
  游戏资产准备、跨软件工作流、批量资产导出

## 材质工具

- **UV 尺寸校准**

  **🔧 概述**  
  根据模型尺寸和纹理尺寸自动调整UV缩放比例，确保纹理在模型上的正确显示。

  **📏 特点**
  - 基于32像素/米的标准比例调整
  - 自动计算并应用最佳UV缩放值
  - 保持纹理细节与物体实际尺寸的正确对应关系

- **材质强度调整**

  **🎛️ 概述**  
  批量调整所选物体的材质属性参数，快速统一场景中物体的材质表现。

  **⚙️ 可调整参数**
  | 参数 | 调整范围 | 用途 |
  |------|---------|------|
  | **发光度** | 0-10 | 控制材质的自发光强度 |
  | **粗糙度** | 0-10 | 调整材质的表面光滑/粗糙程度 |
  | **金属度** | 0-10 | 设置材质的金属特性强度 |

  **🔄 操作方式**  
  选择物体 → 调整滑块参数 → 点击应用按钮

- **材质球节点操作**

  **🔌 概述**  
  提供多种常用的材质节点连接和设置操作，简化材质节点编辑流程。

  **🛠️ 功能列表**
  - **Alpha节点连接**：自动将图像的Alpha通道连接到着色器的Alpha输入
  - **断开Alpha连接**：快速移除Alpha通道连接
  - **Alpha设为肤色**：将指定材质的Alpha部分设置为自定义肤色
  - **设置临近采样**：将纹理设置为临近采样模式，实现硬边缘效果

  **🎯 适用场景**  
  角色材质调整、透明贴图处理、卡通风格渲染

## 批量转换资产

- **模型预处理工具**

  **🔄 概述**  
  提供一系列操作，帮助处理和优化3D模型，使其更适合在游戏引擎或其他应用中使用。

  **⚒️ 核心功能**
  - **独立化应用所有变换**：应用所有旋转、缩放和位置变换，同时断开与其他物体的关联
  - **按顶级层级合并**：将物体按照顶级父级结构进行合并，保持场景的层级组织
  - **重置所选法线**：重新计算所选物体的面法线方向，修复法线方向问题
  - **清理所选空物体**：移除选中物体中的空物体，优化场景结构

  **📋 工作流程**  
  上述功能按顺序使用，可实现模型的完整预处理流程

- **资产管理工具**

  **🏷️ 概述**  
  提供资产标记和转换功能，简化资产管理和格式转换流程。

  **🛠️ 功能列表**
  - **批量标记资产**：将所选物体批量标记为Blender资产，方便在资产浏览器中管理
  - **一键转换vox**：将OBJ文件批量转换为体素格式(VOX)，适用于体素风格游戏
  - **一键转换vox(带颜色)**：转换为带有颜色信息的体素模型，保留原始模型的颜色属性

  **🎯 适用场景**  
  游戏资产准备、像素/体素风格转换、资产库构建

## 重命名工具

- **车辆部件命名工具**

  **🚗 概述**  
  针对车辆模型的专用命名工具，自动识别并命名车轮等关键部件，适用于不同引擎和插件。

  **🛠️ 功能选项**
  - **UnityCar 自动重命名**：识别并按Unity规范命名车轮（需将车辆-Y轴朝前放置）
  - **Rigcar 自动重命名**：识别并按Rigcar插件规范命名车轮（需将车辆-Y轴朝前放置）

  **🎯 使用场景**  
  车辆模型准备、物理骨骼设置、动画绑定前期准备

- **层级与集合命名**

  **📂 概述**  
  基于物体在场景中的父子关系或集合归属进行批量命名，保持场景组织结构的一致性。

  **🔄 功能选项**
  | 功能 | 描述 | 应用场景 |
  |------|------|----------|
  | **子级命名为顶级** | 将物体命名为其顶级父级名称并添加序号 | 角色部件、组装模型 |
  | **命名为所处集合** | 将物体命名为其所在集合的名称 | 场景整理、批量资产管理 |
  | **集合内位置重命名** | 根据物体在集合中的相对位置命名 | 有序物体组、流程化资产 |

  **⚡ 工作方式**  
  自动分析层级关系 → 应用命名规则 → 处理重名冲突

- **名称后缀管理**

  **🏷️ 概述**  
  处理物体名称中的后缀标识，解决重名问题并保持命名整洁。

  **✂️ 功能列表**
  - **移除后缀**：清除物体名称中的序号后缀（如.001、.002等）
  - **移除顶级后缀并解决重名**：清除顶级父级名称后缀并自动解决子物体重名

  **💼 适用场景**  
  多次导入后的模型整理、导出前的名称标准化

- **Mesh数据命名**

  **🔍 概述**  
  同步物体与其网格数据的命名，确保内部数据结构与外部物体命名一致。

  **🔄 双向命名**
  - **Mesh命名为物体**：将网格数据块重命名为其所属物体的名称
  - **物体命名为Mesh**：将物体重命名为其包含的网格数据名称

  **📊 位置命名**
  - **空间顺序重命名**：根据物体在3D空间中的排列顺序进行命名并添加序号

## 物体变换工具

- **空间排列工具**

  **📐 概述**  
  提供多种物体空间排列和变换功能，用于快速布置场景或创建特定排列效果。

  **🔄 排列功能**
  | 功能 | 描述 | 控制参数 |
  |------|------|----------|
  | **列队排列** | 在指定轴向上按等距排列所选物体 | 轴向选择、间距设置、是否使用包围盒 |
  | **随机放置** | 在指定范围内随机分布所选物体 | 随机范围大小、是否保持Y轴高度 |
  | **随机缩放** | 对所选物体应用随机缩放值 | X/Y/Z轴缩放范围、是否统一缩放 |

  **🎯 使用场景**  
  场景布置、自然环境创建、批量资产摆放

- **对齐与放置工具**

  **🧲 概述**  
  提供精确对齐和智能放置功能，帮助快速调整物体位置。

  **🛠️ 功能列表**
  - **批量对齐顶级父级**：将集合A中的物体对齐到集合B中同名物体上
  - **下落至表面**：将所选物体沿Y轴下降直至与目标表面接触
  
  **💼 适用场景**  
  场景重构、多版本物体对齐、地面物体摆放

## 渲染工具

- **批量对象渲染**

  **🖼️ 概述**  
  自动渲染场景中多个物体，生成独立图像文件，适用于产品展示、资产预览生成等场景。

  **⚙️ 主要参数**
  | 参数 | 描述 | 用途 |
  |------|------|------|
  | **输出路径** | 渲染图像的保存目录 | 指定渲染结果存储位置 |
  | **输出名称** | 图像文件名前缀 | 区分不同批次渲染结果 |
  | **输出格式** | 图像文件格式 | 根据需要选择适合的格式 |
  | **渲染集合** | 要渲染的物体集合 | 限定渲染范围 |
  | **相机选择** | 使用的摄像机 | 控制渲染视角 |

  **🔍 智能聚焦功能**
  - **自动聚焦**：渲染时自动调整视图，使物体填满画面（正交模式下有效）
  - **边框距离**：控制物体与视口边缘的距离，避免裁切
  
  **🚀 工作流程**  
  选择参数 → 执行渲染 → 按顶级父级分组处理 → 自动保存结果

- **批量文件渲染设置**

  **🔧 概述**  
  批量修改多个Blender文件的渲染设置，确保渲染参数的一致性，提高工作流效率。

  **⚙️ 可调整参数**
  ```
  ┌─────────────┬────────────────────────────────┐
  │ 基本设置    │ 渲染设置                       │
  ├─────────────┼────────────────────────────────┤
  │ 源文件路径  │ 渲染引擎 (Cycles/Eevee)        │
  │ 输出文件路径│ 输出格式                       │
  │             │ 渲染目标路径                   │
  │             │ 分辨率和百分比                 │
  │             │ 帧率                           │
  └─────────────┴────────────────────────────────┘
  ```

  **📋 操作流程**
  1. 选择包含.blend文件的目录
  2. 设置输出目录保存修改后的文件
  3. 配置所需的渲染参数
  4. 执行批量处理
  5. 系统自动处理所有文件并保存

  **💼 适用场景**  
  多文件渲染项目、团队协作标准化、批量渲染设置更新

## 自动角色绑定工具

**🤖 概述**  
提供快速的角色骨骼绑定系统，通过空间位置关系自动将骨骼与模型部件关联，实现批量硬关节绑定（部件与骨骼的权重非零即一）。

![image](https://github.com/user-attachments/assets/2417383b-a1a7-4df3-90cc-2375f790a7a8)

- **绑定流程与原理**

  **📋 工作流程**
  1. **创建模板**：制作骨骼并创建对应同名空物体作为标记
  2. **导出模板**：将骨骼配置导出为JSON模板
  3. **导入模型**：清空场景，导入需要绑定的新角色模型
  4. **执行绑定**：系统自动检测空间关系并设置绑定
  
  **⚙️ 绑定机制**  
  系统检测目标模型部件与空物体标记的空间位置关系，将物体重命名为对应的空物体名称（与骨骼同名），然后执行基于名称的自动绑定。最终根据JSON中记录的部件合并逻辑完成部件整合。

![image](https://github.com/user-attachments/assets/0f843138-6d72-44b8-87a6-ef3d0b42e4db)

- **骨骼模板工具**

  **🦴 功能列表**
  | 功能 | 描述 |
  |------|------|
  | **导出骨骼** | 将当前选择的骨骼和空物体导出为模板配置 |
  | **还原骨骼** | 从选择的配置还原骨骼和空物体完整结构 |
  | **还原点位** | 仅还原配置中的空物体位置 |
  | **重置端点** | 重置骨骼端点位置使骨骼首尾相连 |
  | **链接骨骼** | 连接首尾重合的骨骼，实现自动IK功能 |

  **📂 配置管理**
  - **配置列表**：显示RigJson文件夹中的所有模板JSON文件
  - **刷新列表**：更新可用模板列表

- **角色处理工具**

  **🔄 预处理功能**
  - **一键处理角色(64)**：对64密度角色模型自动应用所选模板进行绑定
  - **导入模型一键处理**：自动执行断开关联→处理面朝向→创建父级→父级归零→合并顶点→应用变换
  - **重命名并合并**：按模板记录合并部件并重命名
  - **接触底部中心创建父级**：根据部件接触关系自动分组创建父级结构
  - **缩小1/2**：将模型整体缩小一半

  **📤 导出功能** 
  - **导出目录**：设置FBX文件导出位置
  - **导出角色(完整)**：将整个角色导出为单一FBX文件
  - **导出角色(部件)**：按拆分逻辑分别导出不同部件

## 附加信息

- **插件更新**

  **🔄 在线更新功能**  
  插件提供自动更新功能，在Blender偏好设置中可以找到更新按钮。
  
  ⚠️ **重要提示**：更新过程会覆盖所有文件，包括角色配置的JSON文件，请在更新前单独备份这些文件！

- **依赖包管理**

  **📦 依赖项**  
  插件依赖Pillow包处理图像（主要用于渲染后处理、边距调整等）。
  
  **⚙️ 安装方式**
  - **自动安装**：插件激活时会自动安装根目录package文件夹中的依赖包
  - **手动安装**：可使用Blender内置Python执行安装命令
    ```
    cd [Blender安装目录]/python
    python -m pip install pillow
    ```
  
  **🖥️ 跨平台支持**  
  在非Windows平台使用时，需要下载对应平台的.tar.gz或.whl文件放入package文件夹



